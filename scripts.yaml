default_script_params: &reset_params
  PBS_NODES: 1
  PBS_PPN: 1
  PBS_HASWELL: False
  PBS_K20X: False
  PBS_GPU: 0
  PBS_WALLTIME: 4
  PBS_MEM: 4
  PBS_LOG: $WORKING_DIR
  SINGULARITY_NVIDIA: False
  SINGULARITY_VERSION: $SINGULARITY_CONTAINER_VERSION
  SINGULARITY_CONTAINER: $SINGULARITY_CONTAINER_XNAT_PATH

get_data_script: &generic_get
  <<: *reset_params
  SINGULARITY_VERSION: $SINGULARITY_CONTAINER_VERSION
  SINGULARITY_BINDPATH: $XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH
  SINGULARITY_RUNPATH: $GET_DATA_RUNPATH
  SINGULARITY_PARAMS: {
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "classifier": $SUBJECT_CLASSIFIER,
    "working-dir": $WORKING_DIR,
    "scan": $SUBJECT_EXTRA,
  }

mricafix_get_data_script:
  <<: *generic_get
  SINGULARITY_PARAMS: {
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "classifier": $SUBJECT_CLASSIFIER,
    "working-dir": $WORKING_DIR,
    "scan": $SUBJECT_EXTRA,
  }

process_data_script: &generic_process_data
  <<: *reset_params
  PBS_WALLTIME: $WALLTIME_LIMIT_HOURS
  PBS_MEM: $MEM_LIMIT_GBS
  PBS_HASWELL: True
  SINGULARITY_BINDPATH: "${GRADIENT_COEFFICIENT_PATH}:/export/HCP/gradient_coefficient_files,$XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH,$XNAT_PBS_JOBS_CONTROL:/opt/xnat_pbs_jobs_control"
  SINGULARITY_CONTAINER: $SINGULARITY_CONTAINER_PATH
#  SINGULARITY_RUNPATH: $SINGULARITY_QUNEXRUN_PATH
  SINGULARITY_RUNPATH: $RUN_QUNEX_SCRIPT
  SINGULARITY_PARAMS: {
    parameterfolder: $SINGULARITY_QUNEXPARAMETER_PATH,
    studyfolder: "${WORKING_DIR}/${SUBJECT_SESSION}",
    subjects: "${SUBJECT_SESSION}",
    scan: $SUBJECT_EXTRA,
    overwrite: "yes",
    hcppipelineprocess: $PIPELINE_NAME,
  }

functional_process_data_script:
  <<: *generic_process_data
  SINGULARITY_BINDPATH: "${GRADIENT_COEFFICIENT_PATH}:/export/HCP/gradient_coefficient_files,$XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH"

diffusion_process_data_script:
  <<: *generic_process_data
  PBS_HASWELL: False
  PBS_K20X: True
  PBS_GPU: 1
  SINGULARITY_NVIDIA: True
clean_data_script:
  <<: *reset_params
  SINGULARITY_CONTAINER: null

put_data_script:
  <<: *reset_params
  PBS_MEM: 12
  PBS_LOG: $XNAT_PBS_JOBS_LOG_DIR
  SINGULARITY_BINDPATH: $XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH
  SINGULARITY_RUNPATH: "${XNAT_PBS_JOBS}/WorkingDirPut/XNAT_working_dir_put.sh"
  SINGULARITY_PARAMS: {
    "user": $USERNAME,
    "password": $PASSWORD,
    "server": $PUT_SERVER,
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "session": $SUBJECT_SESSION,
    "reason": $PIPELINE_NAME,
    "working-dir": $WORKING_DIR,
    "leave-subject-id-level": null,
    "scan": $SUBJECT_EXTRA,
    "resource-suffix": $OUTPUT_RESOURCE_SUFFIX
  }

check_data_script:
  <<: *reset_params
  PBS_LOG: $XNAT_PBS_JOBS_LOG_DIR
  PBS_HASWELL: True
  SINGULARITY_BINDPATH: $XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH
  SINGULARITY_RUNPATH: $CHECK_DATA_RUNPATH
  SINGULARITY_PARAMS: {
    "user": $USERNAME,
    "password": $PASSWORD,
    "server": $PUT_SERVER,
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "classifier": $SUBJECT_CLASSIFIER,
    "working-dir": $CHECK_DATA_DIR,
    "scan": $SUBJECT_EXTRA,
  }

mark_no_longer_running_script:
  <<: *reset_params
  PBS_LOG: $XNAT_PBS_JOBS_LOG_DIR
  SINGULARITY_BINDPATH: $XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH
  SINGULARITY_RUNPATH: $MARK_RUNNING_STATUS_RUNPATH
  SINGULARITY_PARAMS: {
    "user": $USERNAME,
    "password": $PASSWORD,
    "server": $PUT_SERVER,
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "classifier": $SUBJECT_CLASSIFIER,
    "resource": "RunningStatus",
    "done": null,
    "scan": $SUBJECT_EXTRA,
  }

freesurfer_assessor_script:
  <<: *reset_params
  SINGULARITY_CONTAINER: null
  FREESURFER_PARAMS: {
    "user": $USERNAME,
    "password": $PASSWORD,
    "server": $PUT_SERVER,
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "session": $SUBJECT_SESSION,
    "session-classifier": $SUBJECT_CLASSIFIER,
    "working-dir": $WORKING_DIR,
  }
