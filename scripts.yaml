defaults: &defaults
  GET_DATA_BINDPATH: $XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH,$XNAT_PBS_JOBS_BUILD_DIR
  GET_DATA_PARAMS: {
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "classifier": $SUBJECT_CLASSIFIER,
    "working-dir": $WORKING_DIR,
    "scan": $SUBJECT_EXTRA,
  }
  CHECK_DATA_BINDPATH: $XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH
  CHECK_DATA_PARAMS: {
    "user": $USERNAME,
    "password": $PASSWORD,
    "server": $PUT_SERVER,
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "classifier": $SUBJECT_CLASSIFIER,
    "working-dir": $CHECK_DATA_DIR,
    "scan": $SUBJECT_EXTRA,
  }
  MARK_RUNNING_STATUS_BINDPATH: $XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH
  MARK_RUNNING_STATUS_PARAMS: {
    "user": $USERNAME,
    "password": $PASSWORD,
    "server": $PUT_SERVER,
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "classifier": $SUBJECT_CLASSIFIER,
    "resource": "RunningStatus",
    "done": null,
  }
  PUT_DATA_BINDPATH: $XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH
  PUT_DATA_RUNPATH: "${XNAT_PBS_JOBS}/WorkingDirPut/XNAT_working_dir_put.sh"
  PUT_DATA_PARAMS: {
    "user": $USERNAME,
    "password": $PASSWORD,
    "server": $PUT_SERVER,
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "session": $SUBJECT_SESSION,
    "reason": $PIPELINE_NAME,
    "working-dir": $WORKING_DIR,
    "leave-subject-id-level": null,
    "scan": $SUBJECT_EXTRA,
    "resource-suffix": $OUTPUT_RESOURCE_SUFFIX
  }
  FREESURFER_PARAMS: {
    "user": $USERNAME,
    "password": $PASSWORD,
    "server": $PUT_SERVER,
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "session": $SUBJECT_SESSION,
    "session-classifier": $SUBJECT_CLASSIFIER,
    "working-dir": $WORKING_DIR,
  }
  PROCESS_PBS_HASWELL: True
  PROCESS_PBS_K20X: False
  PROCESS_PBS_GPU: 0
  PROCESS_NVIDIA: False
  PROCESS_DATA_BINDPATH: "${GRADIENT_COEFFICIENT_PATH}:/export/HCP/gradient_coefficient_files,$XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH,$XNAT_PBS_JOBS_CONTROL:/opt/xnat_pbs_jobs_control"
  PROCESS_DATA_PARAMS: {
    parameterfolder: $SINGULARITY_QUNEXPARAMETER_PATH,
    studyfolder: $STUDY_FOLDER,
    subjects: "${SUBJECT_SESSION}",
    scan: $SUBJECT_EXTRA,
    overwrite: "yes",
    hcppipelineprocess: $PIPELINE_NAME,
  }

structural_process: &structural_process
  PROCESS_DATA_BINDPATH: "${GRADIENT_COEFFICIENT_PATH}:/export/HCP/gradient_coefficient_files,$XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH,$BUILD_SPACE,$SCRATCH_SPACE"

structural:
  <<: *defaults
  <<: *structural_process
  GET_DATA_PARAMS: {
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "classifier": $SUBJECT_CLASSIFIER,
    "working-dir": $WORKING_DIR,
    "delay-seconds": 120
  }
  CHECK_DATA_PARAMS: {
    "user": $USERNAME,
    "password": $PASSWORD,
    "server": $PUT_SERVER,
    "project": $SUBJECT_PROJECT,
    "subject": $SUBJECT_ID,
    "classifier": $SUBJECT_CLASSIFIER,
    "working-dir": $CHECK_DATA_DIR,
  }

struct_handedit:
  <<: *defaults
  <<: *structural_process
  PROCESS_DATA_PARAMS: {
    parameterfolder: $SINGULARITY_QUNEXPARAMETER_PATH,
    studyfolder: "${WORKING_DIR}/${SUBJECT_SESSION}", #TODO: figure this out lines 106-110
    subjects: "${SUBJECT_SESSION}",
    scan: $SUBJECT_EXTRA,
    overwrite: "yes",
    hcppipelineprocess: $PIPELINE_NAME,
    #TODO: Figure out what that FS_EXTRA_RECONALL param does and if it is even necessary
    #"fs-extra-reconall": $FS_EXTRA_RECONALL
  }

functional:
  <<: *defaults
  PROCESS_DATA_BINDPATH: "${GRADIENT_COEFFICIENT_PATH}:/export/HCP/gradient_coefficient_files,$XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH"

diffusion:
  <<: *defaults
  PROCESS_PBS_HASWELL: False
  PROCESS_PBS_K20X: True
  PROCESS_PBS_GPU: 1
  PROCESS_NVIDIA: True

msmall: &ms_mall
  <<: *defaults
  SCRATCH_TMP_DIR: /scratch/$USER/singularity/tmp/$SUBJECT_SESSION
  PROCESS_DATA_BINDPATH: "${GRADIENT_COEFFICIENT_PATH}:/export/HCP/gradient_coefficient_files,$XNAT_PBS_JOBS_ARCHIVE_ROOT,$SINGULARITY_BIND_PATH,$XNAT_PBS_JOBS_CONTROL:/opt/xnat_pbs_jobs_control,$SCRATCH_TMP_DIR:/tmp"

mr_icafix:
  <<: *ms_mall
  PROCESS_PBS_HASWELL: False

