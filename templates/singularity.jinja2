{% if SINGULARITY_CONTAINER is defined and SINGULARITY_CONTAINER -%}

module load {{ SINGULARITY_VERSION }}

singularity exec \
{%- if SINGULARITY_BINDPATH is defined -%}
    {%- for bindpath in SINGULARITY_BINDPATH.split(",") %}
    --bind {{ bindpath }} \
    {%- endfor -%}
{%- endif -%}

{%- if SINGULARITY_NVIDIA is defined and SINGULARITY_NVIDIA %}
    --nv \
{%- endif %}
    {{ SINGULARITY_CONTAINER }} \
    {{ SINGULARITY_RUNPATH }} \
{%- if SINGULARITY_PARAMS is defined -%}
    {%- for key, value in SINGULARITY_PARAMS.items() %}
        --{{ key }}{% if value is not none %}="{{ value }}"{% endif %} \
    {%- endfor -%}
{%- endif %}
;


{%- endif %}
